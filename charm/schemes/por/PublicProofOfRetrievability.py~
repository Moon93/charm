'''
Base class for VerifiableProofOfRetrievability
 
Notes: This class implements an interface for a verifiable proof of retrievability scheme.
A verifiable proof of retrievability scheme consists of four algorithms: (keygen, generateVerifiers, proove, verify).
'''
from charm.core.math.integer import *

class VerifiableProofOfRetrievability():
    def __init__(self,bit=80):
        self.p =int(integer(randomPrime(bit)))
		self.group = PairingGroup('SS512')
		self.g = group.random(G1)
		self.u = group.random(G1)
	
	
	
	

    def _getRandomInt(self,range):
        return int(integer(random(range)))    

    def setP(self,p):
        if isPrime(p):
           self.p = p
        else:
            raise BaseException("p is not Prime")

    def keygen(self):
		x = self.group.random(G1) #privateKey
		v = self.g**x #publicKey
        return v

    def splitMessage(self,M):
        message = []
        while M!=0:
             messageBlock = M % self.p
             message.append(messageBlock)
             M = M - messageBlock
             if M!=0:
                  M=M//int(self.p)
        message.reverse()
        return message

	def generateSignature(self,splitMessage,i,x)
		#return sigma_i
		return (self.group.hash(i,G1)*self.u**splitMessage[i])**x
        
    def generateVerifiers(self,splitMessage):
        return NotImplemented
    
    def compositeMessage(self, splitMessage):
        message = 0
        i=0
        while i<len(splitMessage)-1: #for m in splitM | geht leider nicht
             message=(message+splitMessage[i])*self.p
             i=i+1
        message=(message+splitMessage[len(splitMessage)-1])
        return message

    def genChallenge(self,splitMessage,amount):
        challange = []
       	if amount>len(splitMessage):
       		raise BaseException("Amount bigger than number of message blocks")
       	
        return challange
    
    def proove(self, splitMessage, verifier, challange):
        return NotImplemented

    def verify(self, response, challange):
        return NotImplemented
